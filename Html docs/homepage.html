<!DOCTYPE html>
<html>
    <style>
    #event-button{
        position: static;
        right: 100px;
    }
    #logout-button{
        position: absolute;
        right:70px;
    }
    </style>
    <head>
        <title>Project Name</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!--Included Boostrap-->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <div class="container">
            <h2>Project Name</h2>
            <p>We remember so you dont have to</p>
        </div>
    </head>
    <body>
		<div class="container">
            <button type="button" class="btn btn-info" id="event-button" data-toggle="modal"data-target="#ModalCenter">Create a Event</button>
            <button type="button" class="btn btn-warning" id="logout-button">Logout</button>
        </div>
		<!-- Modal -->
        <div class="modal fade" id="ModalCenter" tabindex="-1" role="dialog" aria-labelledby="ModalCenterTitle" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="ModalCenterTitle">Add an Event</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="form-group row"> <!--Input event title-->
                                <label for="event-title" class="col-sm-3 col-form-label">Event Name</label>
                                <div class="col-sm-9">
                                    <input type="text" class="form-control" id="event-title"placeholder="">
                                </div>

                        </div>
                        <div class="form-group row"> <!--Input address-->
                            <label for="address"class="col-sm-3 col-form-label" >Address</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" id="streetaddress" placeholder="Street Address">
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="form-group col-md-6"><!--city input-->
                                <input id="city" type="text" class="form-control" placeholder="City">
                            </div>
                            <div class="form-group col-md-4"><!--state input-->
                                <input id="state" type="text" class="form-control" placeholder="State">
                            </div>
                            <div class="form-group col-md-2"> <!--Zip input-->
                                <input id="zip" type="text" class="form-control" placeholder="Zip">
                            </div>
                        </div>
                        <div class="form-group row"> <!-- Date input -->
                            <label class="col-sm-2 col-form-label" for="date">Date</label>
                            <div class="col-sm-10">
                                <input class="form-control" id="chooseDate" name="date" placeholder="MM/DD/YYYY" type="text"/>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="form-group col-md-4">
                                <label for="inputEventTime"> Event Time: </label> <!--Event time -->
                                <select id="inputEventTime" class="form-control">
                                    <option selected>Event Time</option>
                                    <option>12:00 am</option> <option>12:30 am</option> <option>01:00 am</option> <option>01:30 am</option>
                                    <option>02:00 am</option> <option>02:30 am</option> <option>03:00 am</option> <option>03:30 am</option>
                                    <option>04:00 am</option> <option>04:30 am</option> <option>05:00 am</option> <option>05:30 am</option>
                                    <option>06:00 am</option> <option>06:30 am</option> <option>07:00 am</option> <option>07:30 am</option>
                                    <option>08:00 am</option> <option>08:30 am</option> <option>09:00 am</option> <option>09:30 am</option>
                                    <option>10:00 am</option> <option>10:30 am</option> <option>11:00 am</option> <option>11:30 am</option>
                                    <option>12:00 pm</option> <option>12:30 pm</option> <option>01:00 pm</option> <option>01:30 pm</option>
                                    <option>02:00 pm</option> <option>02:30 pm</option> <option>03:00 pm</option> <option>03:30 pm</option>
                                    <option>04:00 pm</option> <option>04:30 pm</option> <option>05:00 pm</option> <option>05:30 pm</option>
                                    <option>06:00 pm</option> <option>06:30 pm</option> <option>07:00 pm</option> <option>07:30 pm</option>
                                    <option>08:00 pm</option> <option>08:30 pm</option> <option>09:00 pm</option> <option>09:30 pm</option>
                                    <option>10:00 pm</option> <option>10:30 pm</option> <option>11:00 pm</option> <option>11:30 pm</option>
                                </select>
                            </div>
                            <div class="form-group col-md-4">
                                <label for="inputReminderTime">Reminder Time:</label> <!--Time to be Reminded-->
                                <select id="inputReminderTime" class="form-control">
                                    <option selected>Reminder Time</option>
                                    <option>5 minutes before</option> <option>10 minutes before</option> <option>15 minutes before</option> <option>20 minutes before</option>
                                    <option>30 minutes before</option> <option>45 minutes before</option> <option>1 hour before</option>
                                    <option>2 hours before</option> <option>3 hours before</option> <option>4 hours before</option> <option>5 hours before</option>
                                    <option>6 hours before</option> <option>7 hours before</option> <option>8 hours before</option> <option>9 hours before</option>
                                    <option>10 hours before</option> <option>11 hours before</option> <option>12 hours before</option> <option>13 hours before</option>
                                    <option>14 hours before</option> <option>15 hours before</option> <option>16 hours before</option> <option>17 hours before</option>
                                    <option>18 hours before</option> <option>19 hours before </option> <option>20 hours before</option> <option>1 day before</option>
                                </select>
                            </div>
                        </div>
                        <!-- remind others field-->
                    </form>
                </div>
                <div class="modal-footer">
                    <button id="b_create" type="button" class="btn btn-success" data-dismiss="modal">Create</button>
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
                </div>
            </div>
            </div>
        </div>
		<div class="container">
			<table class="table table-striped" id="eventTable">
				<!--<thead>-->
					<tr>
						<th scope="col">Event</th>
                        <th scope="col">Date</th>
                        <th scope="col">Address</th>
						<th scope="col">Time</th>
						<th scopr="col">reminder</th>
					</tr>
				<!--</thead>
				<tbody>-->
				<!--</tbody>-->
			</table>
		</div>
        <script src="https://www.gstatic.com/firebasejs/5.6.0/firebase.js"></script>
        <script>
          // Initialize Firebase
          var config = {
            apiKey: "AIzaSyBD-0alEnH2GSG4-ap3JiGhDHi0M5MFhSg",
            authDomain: "event-planner-2bed5.firebaseapp.com",
            databaseURL: "https://event-planner-2bed5.firebaseio.com",
            projectId: "event-planner-2bed5",
            storageBucket: "event-planner-2bed5.appspot.com",
            messagingSenderId: "654317062394"
          };
          firebase.initializeApp(config);
        </script>
        <script>
        window.onload = function() {
          var key;
          var ref = firebase.database().ref('users');
          var email = localStorage.getItem("email");
          //console.log(email);
          ref.once('value', function(snapshot) {
          snapshot.forEach(function(childSnapshot) {
          var childKey = childSnapshot.key;
          var childData = childSnapshot.val();
          //console.log(childData["email"]);
          if( childData["email"] === email) {
            key = childKey;
            //console.log(key);
          }
        });
      }).then((res) => {
          //console.log("flag");
          var eRef = firebase.database().ref('users/'+ key + '/events/');
          eRef.once('value', function(snapshot) {
          snapshot.forEach(function(childSnapshot) {
          var childData = childSnapshot.val();
          //console.log(childData);
          var name =  childData["name"];
          var address = childData["address"];
          var date = childData["date"];
          var eTime = childData["eTime"];
          var reminder = childData["reminder"];
          $('#eventTable').append('<tr><td>'+name+'</td><td>'+address+' '+city+' '+state+' '+zip+'</td><td>'+eTime+'</td><td>'+reminder+'</td></tr>');
          //start();
        });
      });
    });
  };

        document.getElementById("logout-button").onclick = function() {log_out()};
        function log_out(){
          firebase.auth().signOut().then(function() {
            // Sign-out successful.
            alert('Sign-out successful.');
            window.location.replace("Login.html");
          }).catch(function(error) {
            // An error happened.
            var errorCode = error.code;
            var errorMessage = error.message;
            console.log(error);
          });
        }
        document.getElementById("b_create").onclick = function() {create_event()};
        function create_event(){
            var name = document.getElementById("event-title").value;
            var address = document.getElementById("streetaddress").value;
            var city = document.getElementById("city").value;
            var state = document.getElementById("state").value;
            var zip = document.getElementById("zip").value;
            var date = document.getElementById("chooseDate").value;
            var eTime = document.getElementById("inputEventTime").value;
            var reminder = document.getElementById("inputReminderTime").value;

            //insert element into the table
            $('#eventTable').append('<tr><td>'+name+'</td><td>'+date+'</td><td>'+address+'</td><td>'+eTime+'</td><td>'+reminder+'</td></tr>');

          var user = firebase.auth().currentUser;
          var userId = user.uid;
          var key;

          var ref = firebase.database().ref('users');
          var email = localStorage.getItem("email");
          //console.log(email);
          ref.once('value', function(snapshot) {
          snapshot.forEach(function(childSnapshot) {
          var childKey = childSnapshot.key;
          var childData = childSnapshot.val();
          console.log(childData["email"]);
          if( childData["email"] === email) {
            key = childKey;
            //console.log(key);
          }
        });
      }).then((res) => {
        //console.log(key);
        var data = {
          name: name,
          address: address,
          city: city,
          state: state,
          zip: zip,
          date: date,
          eTime: eTime,
          reminder: reminder,
          email: email
        };
        var updates = {};
        updates['/users/' + key + '/events/' + name] = data;
        firebase.database().ref().update(updates);
        //ref.push(data);
      });
        }
        </script>

    <!-- Optional JavaScript -->
        <!-- jQuery first, then Popper.js, then Bootstrap JS -->
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
        <!-- Include jQuery -->
        <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
        <!--Include Script for date picker-->
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/js/bootstrap-datepicker.min.js"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/css/bootstrap-datepicker3.css"/>
        <script>
            $(document).ready(function(){
                var date_input=$('input[name="date"]'); //our date input has the name "date"
                var container=$('.bootstrap-iso form').length>0 ? $('.bootstrap-iso form').parent() : "body";
                date_input.datepicker({
                    format: 'mm/dd/yyyy',
                    container: container,
                    todayHighlight: true,
                    autoclose: true,
                })
            })
        </script>
    </body>
</html>
